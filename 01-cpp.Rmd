# Rappels : le marché en concurrence pure et parfaite

```{r setupcpp, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
```

## Les hypothèses de la concurrence pure et parfaite (CPP)


```{r theme}
theme_perso <- function(base_size = 14) {
    theme_bw(base_size = base_size) %+replace%
        theme(
      # L'ensemble de la figure
      plot.title = element_text(size = rel(1), face = "bold", margin = margin(0,0,5,0), hjust = 0),
      # Zone où se situe le graphique
      panel.grid.minor = element_blank(),
      panel.border = element_blank(),
      # Les axes
      axis.title = element_text(size = rel(0.85), face = "bold"),
      axis.text = element_text(size = rel(0.70), face = "bold"),
      axis.line = element_line(color = "black", arrow = arrow(length = unit(0.3, "lines"), type = "closed")),
      # La légende
      legend.title = element_text(size = rel(0.85), face = "bold"),
      legend.text = element_text(size = rel(0.70), face = "bold"),
      legend.key = element_rect(fill = "transparent", colour = NA),
      legend.key.size = unit(1.5, "lines"),
      legend.background = element_rect(fill = "transparent", colour = NA),
      # Les étiquettes dans le cas d'un facetting
      strip.background = element_rect(fill = "#17252D", color = "#17252D"),
      strip.text = element_text(size = rel(0.85), face = "bold", color = "white", margin = margin(5,0,5,0))
    )
}

theme_set(theme_perso())
```

Il y a 5 hypothèses qui définissent la concurrence pure et parfaite :

1. Atomicité des agents
2. Information parfaite
3. Mobilité parfaite des facteurs de production
4. Homogénéité des biens
5. Libre entrée et sortie du marché

:::{.hypothesis name="Atomicité des agents"}
L'hypothèse d'atomicité des agents implique que personne n'a d'influence *individuellement* sur les prix.
En d'autres termes, chaque acteur est petit face au marché et considère le prix du marché comme une *donnée* qu'il ne peut pas influencer.
On dit que les agents sont *price-taker* sur le marché.
:::

:::{.hypothesis name="Information parfaite"}
L'hypothèse d'information parfaite signifie que tous les acteurs disposent de toutes les informations pertinentes pour prendre leurs décisions.
Il n'y a, par exemple, pas de coût de recherche d'information.
:::

:::{.hypothesis name="Mobilité parfaite des facteurs de production"}
L'hypothèse de mobilité parfaite des facteurs de production garantit l’homogénéité spatiale du prix des facteurs.
Les facteurs de production se déplacent où ils sont le mieux rémunérés.
Les différences de coûts entre producteurs ne peuvent donc être dus qu'au différence technologique entre ceux-ci, et non à une différence de coût des facteurs de production.
:::

:::{.hypothesis name="Homogénéïté des biens"}
L’homogénéité des biens signifie que tous les biens vendu sur un marché sont parfaitement substituables.
Sur un marché donné, tous les biens ont la même qualité.
Le consommateur est donc indifférent entre tous les biens vendus.
Il n'y aussi pas d'effet des marques.
:::

:::{.hypothesis name="Libre entrée et sortie du marché"}
L'hypothèse de libre entrée et sortie du marché signifie qu'il n'y pas de barrière à l'entrée dans le marché.
Concrètement, cela implique qu'il est impossible de faire du bénéfice sur la dernière unité vendue en concurrence pure et parfaite, sinon un concurrent pourrait entrer sur le marché et faire des bénéfices.
:::

La violation d'une de ces hypothèses nous fait sortir du cadre de la CPP et confère un *pouvoir de marché* aux producteurs en place.

## Le Producteur

### Fonctions de coût

En général, un producteur est caractérisé par une fonction de production, c'est-à-dire une fonction qui donne  les quantités produites de biens en fonction des facteurs de productions.
À l'aide de cette fonction de production, il est possible de construire une fonction de coût.

:::{.definition name="Fonction de coût total"}
La fonction de coût total, notée $C$ ou $CT$ donne le coût total de production de $q$ unités de bien.
Elle peut se décomposer en un *coût fixe* $CF$ (qui ne dépend pas de $q$) et un *coût variable* $CV$ qui dépend de $q$ :
\[CT(q)=CF+ CV(q)\]
:::

:::{.definition name="Coût moyen"}
Le coût moyen est le coût de production moyen d'une unité, noté $CM$ :
\[CM(q) = \frac{CT(q)}{q}\]
:::
On peut décomposer le coût moyen en un *coût fixe moyen* $CFM$ :
\[CFM(q)=\frac{CF}{q}\]
Et un *coût variable moyen* $CVM$ :
\[CVM(q)=\frac{CV(q)}{q}\]
On a alors :
\begin{equation}
CM(q)=CFM(q) +CVM(q)
(\#eq:CM)
\end{equation}

::: {.proof}
\[
\begin{array}{rcl}
CM(q) &=& \frac{CT(q)}{q}\\
 &=& \frac{CF + CV(q)}{q}\\
 &=& \frac{CF}{q}+\frac{CV(q)}{q}\\
 &=& CFM(q) + CVM(q)
\end{array}
\]
:::

::: {.definition name="Coût marginal"}
Le coût marginal, noté $C_m$, est l'augmentation du coût lié à la production d'une unité supplémentaire :
\[C_m(q)=\lim_{\Delta q\to 0}\frac{CT(q+\Delta q)-CT(q)}{\Delta q}=CT'(q)\]
:::
Autrement dit, le coût marginal est la variation de coût total quand la production varie "un tout petit peu" (infiniment peu en fait).

::: {.proposition name="Forme de courbes de coût"}
Le coût marginal diminue d'abord, puis augmente par la suite, car la productivité marginale est d'abord croissante, puis décroissante, en général.  
Le coût variable moyen est d'abord décroissant, puis croissant, pour la même raison.  
Le coût fixe moyen est toujours décroissant, car le coût fixe ne dépend pas des quantités produites et $CFM=CF/q$ est donc une fonction inverse.  
La décomposition donnée par l'équation \@ref(eq:CM) implique que le coût moyen est d'abord décroissant, puis croissant.
:::

::: {.proposition name="Relation entre les coûts"}
Lorsque le coût marginal est inférieur au coût (variable) moyen ($C_m(q)<CM(q)$), le coût moyen diminue.
Lorsque le coût marginal est supérieur au coût (variable) moyen ($C_m(q)>CM(q)$), le coût moyen augmente.
La courbe de coût marginal coupe donc la courbe de coût (variable) moyen à son minimum.
:::
L'intuition de ce résultat est simple : si le coût marginal d'une unité supplémentaire est supérieur au coût moyen, alors l'unité supplémentaire produite sera plus chère que la moyenne du coût des unités précédentes produites, augmentant de ce fait le coût moyen.

:::{ .proof }
En son minimum, le coût moyen est tel que $CM'(q)=0$.
\[
\begin{array}{crcl}
&CM'(q)&=&0\\
\Leftrightarrow & \left(\frac{CT(q)}{q}\right)'&=& 0\\
\Leftrightarrow & \frac{CT'(q)q-CT(q)}{q^2}&=& 0\\
\Leftrightarrow & \frac{C_m(q)}{q}-\frac{CT(q)}{q^2}&=& 0\\
\Leftrightarrow & C_m(q)q-CT(q)&=& 0\\
\Leftrightarrow & C_m(q)&=& \frac{CT(q)}{q}\\
\Leftrightarrow & C_m(q)&=& CM(q)
\end{array}
\]
CQFD.
:::

```{r cppcout, fig.cap="Exemples de fonctions de coût (ici $C_m$ est tout le croissante)"}
CV <- function(q){1/(1+q)+q^2/2+q}
CF <- function(q){1}
CT <- function(q){CV(q)+CF(q)}
Cm <- function(q){-1/(1+q)^2+q+1}
CM <- function(q){CT(q)/q}
CVM <- function(q){CV(q)/q}

p_cppcout <- ggplot() +
  geom_function(fun=Cm, color="blue") +
  geom_function(fun=CM, color="red") +
  geom_function(fun=CVM, color="darkgreen") +
  labs(x="quantité", y="coût") +
  annotate("text", x=8, y=4.5, label=TeX("$CVM$"), color="darkgreen") +
  annotate("text", x=8, y=5.5, label=TeX("$CM$"), color="red") +
  annotate("text", x=8, y=9, label=TeX("$C_m$"), color="blue")
  
p_cppcout + scale_y_continuous(expand=c(0, 0), limits=c(0, 10), breaks=c(), labels=c()) +
  scale_x_continuous(expand=c(0, 0), limits=c(0, 10), breaks=c(), labels=c())
```

### L'offre du producteur

::: {.definition name="Recette totale"}
La recette totale, notée $RT$, est le produit de la vente des unités de biens.
Pour $q$ unités de bien vendus, le producteur gagne $RT(q)$, autrement dit, c'est le chiffre d'affaire du producteur (pour ce bien).
:::

::: {.definition name="Recette marginale"}
La recette marginale, notée $R_m$ est la recette rapportée par une unité supplémentaire de bien.
\[R_m(q)=RT'(q)\]
:::

::: {.definition name="Profit"}
Le profit, noté $\pi$ est la différence entre la recette totale est le coût total de production :
\[\pi(q)=RT(q)-CT(q)\]
:::

Le producteur choisit la quantité produite de manière à maximiser son profit.

::: {.definition name="Programme du producteur"}
Le programme du producteur est :
\[\max_q\pi(q)=\max_q RT(q)-CT(q)\]
:::

::: {.theorem name="Offre du producteur"}
En concurrence pure et parfaite, le programme du producteur est tel que la quantité produite $q$ égalise coût marginal et recette marginale.
À l'optimum :
\begin{equation}
R_m(q) =c_m(q)
(\#eq:cppopti)
\end{equation}
:::

::: {.proof}
Le programme du producteur est de maximiser son profit :
\[\max_q\pi(q)=\max_q RT(q)-CT(q)\]
À l'optimum, et à condition que les fonctions de coût et de recette soient dérivables (ce qui sera toujours le cas ici), cela signifie que l'on doit avoir la condition du premier ordre :
\[\pi'(q)=0\Leftrightarrow RT'(q)-CT'(q)=0\Leftrightarrow R_m(q)=C_m(q)\]
On obtient donc bien l'équation \@ref(eq:cppopti)
:::

L'intuition pour ce résultat est assez simple.
Si on a $R_m(q)>C_m(q)$, alors augmenter la quantité produite rapporte plus que cela ne coûte, et donc augmente le profit.
À l'inverse, si $R_m(q)<C_m(q)$, diminuer la quantité produite diminue plus le coût que la recette du producteur, et donc augmente le profit. 
La situation s'équilibre donc pour $R_m(q)=C_m(q)$.
Si cette égalité n'est pas vérifiée, le producteur peut en effet augmenter son profit en jouant sur la quantité produite.

En concurrence pure et parfaite, le producteur est *price-taker*.
Le prix sur le marché est unique et donné , il vaut $p$ et ne dépend pas des quantités produites par *un* producteur.
Le producteur vend son bien au prix défini par le marché.
La recette totale devient donc $RT(q)=p\times q$, avec $p$ fixé.
La recette marginale est donc $R_m(q)=RT'(q)=p$.
En réécrivant l'équation \@ref(eq:cppopti), on obtient en concurrence pure et parfaite :
\[p=C_m(q)\]

::: {.proposition name="Courbe d'offre en CPP"}
En concurrence pure et parfaite, la courbe d'offre du producteur est la courbe de coût marginal.
\[p=C_m(q)\]
:::

Le profit du producteur s'écrit alors :
\[\pi(q)=RT(q)-CT(q)=pq-CT(q)=pq-CM(q)q=q(p-CM(q))\]
Autrement dit, le profit d'un producteur en concurrence pure et parfaite et la différence entre le prix de vente et le coût moyen de production multiplié par le nombre d'unités vendues.
Si ce prix est inférieur au coût moyen de toutes les unités vendues, le profit sera négatif.

```{r cpp_profit, fig.cap="Profit d'un producteur en concurrence pure et parfaite"}
pi <- data.frame(x=c(0, 5), ymin=c(CM(5), CM(5)), ymax=c(Cm(5), Cm(5)))

p_cppcout + geom_ribbon(data=pi, aes(x=x, ymin=ymin, ymax=ymax), fill="green", alpha=0.5) +
  annotate("text", x=2, y=5, label=TeX("$\\pi$"), color="darkgreen") +
  geom_segment(data=pi, x=5, y=0, xend=5, yend=Cm(5), linetype="dashed") +
  geom_segment(data=pi, x=0, y=CM(5), xend=5, yend=CM(5), linetype="dashed") +
  geom_segment(data=pi, x=0, y=Cm(5), xend=5, yend=Cm(5), linetype="dashed") +
  scale_y_continuous(expand=c(0, 0), limits=c(0, 10), breaks=c(CM(5), Cm(5)), labels=c(TeX("$CM(q^*)$"), TeX("p"))) +
  scale_x_continuous(expand=c(0, 0), limits=c(0, 10), breaks=c(5), labels=c(TeX("$q^*$")))

```

## L'équilibre de marché

:::{.definition name="Demande agrégée (D)"}
La *demande agrégée (D)* est la somme des demandes individuelles pour chaque niveau de prix.
:::

:::{.definition name="Offre agrégée (S)"}
L'*offre agrégée (S)* est la somme des offres individuelles pour chaque niveau de prix.
:::

L'équilibre de marché se fait à l'intersection entre S et D (quand S=D).


```{r marche, fig.cap="Equilibre de marché."}

x=seq(0, 1, length=11)
df <- data.frame(x)

S <- function(q){q}
D <- function(q){1-q}


p <- ggplot(df, aes(x=x)) +
    stat_function(fun=function(x) D(x), colour = "blue") +
    stat_function(fun=function(x) S(x), colour = "red") +
    scale_y_continuous(expand = c(0, 0), breaks = c(0.5), labels = c("p*"), limits = c(0, 1.2)) +
    scale_x_continuous(expand = c(0, 0), breaks = c(0.5), labels = c("q*"), limits = c(0, 1.2)) +
    labs(x="quantité", y = "prix") +
    annotate("text", x = 1.1, y = 1, label ="S", colour = "red") +
    annotate("text", x = 0.1, y = 1, label ="D", colour = "blue") +
    geom_segment(x = 0.5, y = 0, xend = 0.5, yend = 0.5, linetype="dashed") +
    geom_segment(x = 0, y = 0.5, xend = 0.5, yend = 0.5, linetype = "dashed")


p
```


La courbe de demande correspond à la suite des prix de réserve des individus, c'est-à-dire aux prix maximal que chaque individu est prêt à payer pour obtenir une unité *supplémentaire* du bien.

La courbe d'offre correspond à la série des coûts marginaux de production, c'est-à-dire les prix minimaux auxquels les producteurs souhaitent vendre une unité supplémentaire du bien.

La vente de toutes les unités jusqu'à la quantité d'équilibre $q^*$ au prix $p^*$ procure un *surplus* aux agents économiques.

:::{.definition name="Surplus des consommateurs"}
Le surplus des consommateurs est la somme des différences entre le prix de réserve des consommateurs et le prix payé par le consommateur pour obtenir les biens.
Sur le graphique quantité prix $(q, p)$, c'est l'aire compris entre la courbe de demande est la droite horizontale dont l'ordonnée est le prix d'échange.
Formellement :
\[S_c=\int_0^{q^*}P(q)-p^* dq\]
:::

::: {.remark}
Seule la dernière unité de bien achetée par les consommateur l'est au prix de réserve.
Il n'y a pas de gain à l'échange pour cette unité, mais pour toutes les autres, il y en a, ce qui explique pourquoi il y a un surplus à l'échange, et pourquoi celui-ci à lieu.
:::

:::{.definition name="Surplus des producteurs"}
Le surplus des producteurs est la somme des différences entre le prix auquel les producteurs vendent le bien et la courbe de coût marginal, qui représente le coût d'une unité supplémentaire produite.
Sur le graphique quantité prix $(q, p)$, c'est l'aire compris entre le prix de vente et la courbe de coût marginal.
Formellement :
\[S_p=\int_0^{q^*}p^*-S(q) dq\]
:::

En pratique, on utilisera jamais la formule avec des intégrales, mais on calculera l'aire du triangle (ou trapèze) concerné.

```{r surplus, fig.cap="Surplus des consommateurs et des producteurs."}

Sc = data.frame(x = c(0, 0.5), y = c(1, 0.5))
Sp = data.frame(x = c(0, 0.5), y = c(0, 0.5))

p + geom_ribbon(data = Sc, aes(x=x, ymin=0.5, ymax = y), fill="blue") +
    geom_ribbon(data = Sp, aes(x=x, ymin=y, ymax = 0.5), fill="red")
```

:::{ .proposition #cppprop name="Propriétés de l'équilibre en concurrence pure et parfaite"}
L'équilibre en CPP est celui qui **maximise** le *surplus total*.
Tout autre couple prix/quantité abouti à un surplus total plus faible.  
L'équilibre de CPP est *Pareto-optimal*, i.e., il est impossible d'améliorer la situation d'un agent sans détériorer celle d'un autre.
C'est ce qu'on appelle le *premier théorème du bien-être*.
:::

Ces propriétés font de la CPP une "référence" par rapport à laquelle on peut comparer les résultats des autres structures de marché.

## Perception par les agents isolés

L'hypothèse d'atomicité indique que les agents individuels sont isolés au sein d'un très grand nombre d'autres agents.
Ainsi, aucun agent n'a d'influence sur le prix s'il modifie son comportement.
Une conséquence directe est que le comportement des autres agents est perçu comme étant infiniment élastique.
C'est-à-dire qu'un producteur sait qu'au prix de marché, il pourra vendre toute sa production, mais que s'il pratique un prix même légèrement plus élevé, il ne vendra **rien**.
Il perçoit ainsi une demande infiniment élastique au prix,  au niveau du prix $p^*$.


```{r elasticite, fig.align='center', fig.cap="Perception de la demande globale par un producteur isolé."}

x=seq(0, 1, length=11)
df <- data.frame(x)

S <- function(q){q}
D <- function(q){1-q}


p <- ggplot(df, aes(x=x)) +
    stat_function(fun=function(x) S(x), colour = "red") +
    geom_hline(yintercept = 0.5, colour = "blue") +
    scale_y_continuous(expand = c(0, 0), breaks = c(0.5), labels = c("p*"), limits = c(0, 1.2)) +
    scale_x_continuous(expand = c(0, 0), breaks = c(0.5), labels = c("q*"), limits = c(0, 1.2)) +
    labs(x="quantité", y = "prix") +
    annotate("text", x = 0.9, y = 1, label ="offre individuelle", colour ="red") +
    annotate("text", x = 0.8, y = 0.55, label ="demande perçue", colour ="blue") +
    geom_segment(x = 0.5, y = 0, xend = 0.5, yend = 0.5, linetype="dashed") +
    geom_segment(x = 0, y = 0.5, xend = 0.5, yend = 0.5, linetype = "dashed")


p
```

Dans ce graphique, $q^*$ représente la production optimale de ce producteur quand il est seul.

## Exercices

:::{ .exercise #cppexo1}

On considère un consommateur dont la fonction de demande optimale pour un bien est donnée par :
\[
Q(p)=10-p
\]
où $p$ est le prix du bien.


1. Donnez la fonction de demande inverse correspondante. Représentez la graphiquement.
2. Quel est le prix maximum que le consommateur est prêt à payer pour la première unité de bien ? Et pour la cinquième ?
3. Calculez le surplus du consommateur lorsque le prix est de $p=2$. Interprétez la valeur obtenue. 
:::

:::{.solution name="Exercice \@ref(exr:cppexo1)"}
La fonction de demande inverse est la fonction inverse de la fonction de demande.
Autrement dit, elle exprime le prix $P$ en fonction de la quantité $q$ plutôt que la quantité $Q$ en fonction du prix $p$.
Ici on $q=10-p$, ce qui équivaut à $p=10-q$.
La fonction de demande inverse est donc $P(q)=10-q$.
Graphiquement, on obtient :

```{r cppexo11, fig.cap="Représentation graphique de la demande inverse."}
P <- function(q){10-q}

p <- ggplot() +
  geom_function(fun=P, color="blue") +
  labs(x="quantité", y = "prix") +
  annotate("text", x= 6, y=6, label="Demande inverse", color="blue")

p + scale_x_continuous(expand = c(0, 0), limits=c(0, 12), breaks=c(10), labels=c(10)) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 12), breaks=c(10), labels=c(10))

```

2. Pour la première unité de bien, on utilise la fonction de demande inverse.
Le prix que le consommateur est prêt à payer pour la première unité est $P(q=1)=9$.
Pour la cinquième unité, c'est $P(q=5)=5$.
Dans les deux cas, ce sont le prix maximal que les consommateurs sont prêts à payer pour l'unité supplémentaire du bien.
Rappelez-vous que la courbe de demande inverse représente l'ensemble des prix maximaux que les consommateurs sont prêts à payer pour une unité supplémentaire du bien.

3. Le surplus du consommateur est la somme des différences entre le prix maximal que chaque individu est prêt à payer et le prix auquel il paie effectivement le bien.
Mathématiquement, le surplus du consommateur s'exprime toujours ainsi :
\[
S_c=\int_0^{q^*}P(q)-p^*dq
\]
Où $p^*$ et $q^*$ représente le prix sur le marché, et $q^*$ la quantité échangée.


```{r cppexo13, fig.cap="Représentation graphique du surplus du consommateur."}
Sc=data.frame(x=c(0, 8), ymin=c(2, 2), ymax=c(10, 2))

p + geom_ribbon(data=Sc, aes(x=x, ymin=ymin, ymax=ymax), fill="blue", alpha=0.5) +
  scale_x_continuous(expand = c(0, 0), limits=c(0, 12), breaks=c(8, 10), labels=c(TeX("$q^*=8$"), 10)) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 12), breaks=c(2, 10), labels=c(TeX("$p^*=2$"), 10)) +
  geom_segment(data=Sc, aes(x=x), x=0, y=2, xend=8, yend=2, linetype="dashed") +
  annotate("text", x=2, y=5, label="Surplus du consommateur", color="blue") +
  geom_segment(data=Sc, aes(x=x), x=8, y=0, xend=8, yend=2, linetype="dashed")
```

En général, comme on peut le voir sur la figure \@ref(fig:cppexo13), il est possible de calculer le surplus en utiliser la formule donnant l'aire d'un triangle.
Ici, on obtient :
\[S_c=\frac{1}{2}(10-2)\cdot(8-0)=32\]
Les consommateurs "gagnent" donc 32 par rapport à la situation où ils devraient payer chacun leur prix de réserve.
:::


:::{ .exercise #cppexo2}
On considère une firme faisant face à la contrainte technologique donnée par la fonction de coût total :
\[C(q)=q^2+10q\]

1. Donnez la fonction de coût marginal correspondant.
2. Déterminez la fonction d'offre de cette firme. Représentez la graphiquement.
3. On suppose que la fonction de demande inverse du marché est donnée par :
\[P(q)=100-q\]
Déterminez le prix d'équilibre sur le marché, le surplus du producteur, le surplus du consommateur ainsi que le surplus total.
4. Supposons que l'État impose un prix $p=80$. Quelle va être la quantité échangée ? Quel sera le surplus total ? Et si l'état impose un prix $p=20$ ? Représentez graphiquement ces deux situations. En déduire que l'équilibre concurrentiel maximise le surplus total.
:::

:::{.solution name="Exercice \@ref(exr:cppexo2)"}
La fonction de coût marginal est la dérivée de la fonction de coût total.
La fonction de coût marginal donne le coût de production d'une unité de bien supplémentaire.
\[C_m(q)=C'(q)=2q+10\]

2. La fonction d'offre des producteurs en concurrence pure et parfaite est égale à la fonction de coût marginal.
Si on la note $S$, $S(q)=C_m(q) = 2q+10$.
C'est le prix minimal auquel elle est prête à vendre une unité de bien supplémentaire.

```{r cppexo22, fig.cap="Représentation graphique de la demande inverse."}
S <- function(q){10+2*q}

p <- ggplot() +
  geom_function(fun=S, color="red") +
  labs(x="quantité", y = "prix") +
  annotate("text", x=50, y=75, label="Offre", color="red")

p + scale_x_continuous(expand = c(0, 0), limits=c(0, 100)) +
  scale_y_continuous(expand = c(0, 0), limits = c(0, 100))

```

3. A l'équilibre sur le marché, une quantité $q^*$ de biens est échangée au prix $p^*$.
Le marché vérifie alors les équations suivantes :
\begin{equation}
p^*=S(q^*)=P(q^*)
(\#eq:cppequilibre)
\end{equation}
Commençons par la deuxième partie de l'équation \@ref(eq:cppequilibre) :
\begin{align*}{crcl}
&2q^*+10&=&100-q^*\\
\Leftrightarrow&3q^*&=&90\\
\Leftrightarrow & q^*&=&30
\end{align*}
La quantité échangée à l'équilibre est donc de $q^*=30$.
A l'aide de la quantité échangée est de la première partie de l'équation \@ref(eq:cppequilibre), on obtient
\[
p^*=P(q^*=30) = 100-30=70 
\]
Sur le marché, 30 unités de bien sont donc échangés au prix de 70.
On peut alors représenter les surplus sur le marché, comme dans la figure \@ref(fig:cppexo23).
Le surplus des consommateurs est l'aire du triangle bleu, il vaut 
\[S_c=\frac{1}{2}(100-70)\times(30-0)=450\]
Le surplus des producteurs est l'aire du triangle rouge :
\[
S_p=\frac{1}{2}(70-10)\times(30-0) = 900
\]

```{r cppexo23, fig.cap="Surplus en CPP."}
P <- function(q){100 - q}
Sc <- data.frame(x=c(0, 30), ymin=c(70, 70), ymax=c(100, 70))
Sp <- data.frame(x=c(0, 30), ymin=c(10, 70), ymax=c(70, 70))

p + geom_function(fun=P, color="blue") +
  annotate("text", x=80, y=20, label="Demande globale", color="blue") +
  scale_x_continuous(expand = c(0, 0), limits=c(0, 110), breaks=c(0, 30, 100), labels=c(0, TeX("$q^*=30$"), 100)) +
  scale_y_continuous(expand = c(0, 0), limits=c(0, 110), breaks=c(10, 70, 100), labels=c(10, TeX("$p^*=70$"), 100)) +
  geom_ribbon(data=Sc, aes(x=x, ymin=ymin, ymax=ymax), fill="blue", alpha=0.5) +
  geom_ribbon(data=Sp, aes(x=x, ymin=ymin, ymax=ymax), fill="red", alpha=0.5) +
  annotate("text", x=20, y=80, label="Surplus du consommateur", color="blue") +
  annotate("text", x=20, y=50, label="Surplus du producteur", color="red") +
  geom_segment(data=Sc, aes(x=x), x=0, xend=30, y=70, yend=70, linetype="dashed") +
  geom_segment(data=Sc, aes(x=x), x=30, xend=30, y=0, yend=70, linetype="dashed") 
```

Le surplus total est la somme des surplus des producteurs et des consommateurs :
\[
S_t^{CPP}=S_c+S_p=1350
\]

4. On regarde maintenant le cas l'état impose un prix $p^E=80$.
La demande globale vaut alors de $Q(p^E)=100-p^E=20$, que l'on l'obtient en inversant la demande inverse, autrement dit en trouvant la quantité $q$ telle que $P(q)=p^E=80$.
L'offre globale vaut $S(p^E)=\frac{p^E-10}{2}=35$, que l'on obtient en inversant la fonction d'offre, autrement dit en trouvant la quantité $q$ telle que $S(q)=p^E=80$.
La demande globale est plus faible que l'offre globale, c'est donc la demande globale qui fixera les quantités échangées. 
La quantité échangée vaut donc 20.
Graphiquement, on obtient la figure \@ref(fig:cppexo24prixhaut).

```{r cppexo24prixhaut, fig.cap="Surplus en quand l'Etat impose un prix $p^E=80$."}
Sc <- data.frame(x=c(0, 20), ymin=c(80, 80), ymax=c(100, 80))
Sp <- data.frame(x=c(0, 20), ymin=c(10, 50), ymax=c(80, 80))

p + geom_function(fun=P, color="blue") +
  annotate("text", x=80, y=20, label="Demande globale", color="blue") +
  scale_x_continuous(expand = c(0, 0), limits=c(0, 110), breaks=c(0, 20, 100), labels=c(0, TeX("$q^E=20$"), 100)) +
  scale_y_continuous(expand = c(0, 0), limits=c(0, 110), breaks=c(10, 50, 80, 100), labels=c(10, 50, TeX("$p^E=80$"), 100)) +
  geom_ribbon(data=Sc, aes(x=x, ymin=ymin, ymax=ymax), fill="blue", alpha=0.5) +
  geom_ribbon(data=Sp, aes(x=x, ymin=ymin, ymax=ymax), fill="red", alpha=0.5) +
  annotate("text", x=20, y=90, label="Surplus du consommateur", color="blue") +
  annotate("text", x=20, y=60, label="Surplus du producteur", color="red") +
  geom_segment(data=Sc, aes(x=x), x=0, xend=20, y=80, yend=80, linetype="dashed") +
  geom_segment(data=Sc, aes(x=x), x=20, xend=20, y=0, yend=80, linetype="dashed") +
  geom_segment(data=Sc, aes(x=x), x=0, xend=20, y=50, yend=50, linetype="dashed")
```
Le surplus total est dans ce cas l'aire du trapèze bleu et rouge.
Il nous faut obtenir le point sur la courbe d'offre pour la quantité $q^E$.
En ce point, le prix est $S(q^E)=50$.
\[
S_t=\frac{1}{2}(100-10+80-50)\times(20-0)=1200 < S_t^{CPP}
\]
Le surplus total est dans ce cas plus faible qu'en CPP.

On s'intéresse finalement au cas où l'état impose un prix $p^E=20$.
La demande globale vaut alors de $Q(p^E)=100-p^E=80$, que l'on l'obtient en inversant la demande inverse, autrement dit en trouvant la quantité $q$ telle que $P(q)=p^E=20$.
L'offre globale vaut $S(p^E)=\frac{p^E-10}{2}=5$, que l'on obtient en inversant la fonction d'offre, autrement dit en trouvant la quantité $q$ telle que $S(q)=p^E=20$.
L'offre globale est plus faible que la demande globale, c'est donc l'offre globale qui fixera les quantités échangées. 
La quantité échangée vaut donc 20.
Graphiquement, on obtient la figure \@ref(fig:cppexo24prixbas).

```{r cppexo24prixbas, fig.cap="Surplus en quand l'Etat impose un prix $p^E=20$."}
Sc <- data.frame(x=c(0, 5), ymin=c(95, 95), ymax=c(100, 95))
Sp <- data.frame(x=c(0, 5), ymin=c(10, 20), ymax=c(95, 95))

p + geom_function(fun=P, color="blue") +
  annotate("text", x=80, y=20, label="Demande globale", color="blue") +
  scale_x_continuous(expand = c(0, 0), limits=c(0, 110), breaks=c(0, 5, 100), labels=c(0, TeX("$q^E=5$"), 100)) +
  scale_y_continuous(expand = c(0, 0), limits=c(0, 110), breaks=c(10, 20, 95, 100), labels=c(10, 20, TeX("$p^E=95$"), 100)) +
  geom_ribbon(data=Sc, aes(x=x, ymin=ymin, ymax=ymax), fill="blue", alpha=0.5) +
  geom_ribbon(data=Sp, aes(x=x, ymin=ymin, ymax=ymax), fill="red", alpha=0.5) +
  annotate("text", x=15, y=100, label="Surplus du consommateur", color="blue") +
  annotate("text", x=15, y=60, label="Surplus du producteur", color="red") +
  geom_segment(data=Sc, aes(x=x), x=0, xend=5, y=95, yend=95, linetype="dashed") +
  geom_segment(data=Sc, aes(x=x), x=5, xend=5, y=0, yend=95, linetype="dashed") +
  geom_segment(data=Sc, aes(x=x), x=0, xend=5, y=20, yend=20, linetype="dashed")
```
Le surplus total est dans ce cas l'aire du trapèze bleu et rouge.
Il nous faut obtenir le point sur la courbe d'offre pour la quantité $q^E$.
En ce point, le prix est $S(q^E)=20$.
\[
S_t=\frac{1}{2}(100-10+95-20)\times(5-0)=\frac{825}{2}=412.5 < S_t^{CPP}
\]
Le surplus total est dans ce cas aussi plus faible qu'en CPP.

Ces deux situations illustrent les deux cas qui s'écartent de la CPP : un prix plus élevé ou un prix plus faible.
Dans les deux cas, on voit que le surplus total est plus faible.
Ce serait vrai pour n'importe quel prix différent du prix de la concurrence pure et parfaite.
On illustre ainsi le fait que l'équilibre de CPP maximise le surplus total.
:::


 